{% extends 'base.html' %}

{% load i18n %}
{% load static %}

{% block extra_head %}
<script >
    function copyToClipboard() {
      var copyText = document.getElementById("shortened_url");
    
      /* Select the text field */
      copyText.select();
      copyText.setSelectionRange(0, 99999); /*For mobile devices*/
    
      /* Copy the text inside the text field */
      document.execCommand("copy");
    
      console.log("Copied the text: " + copyText.value);
      /* make message visible*/
      var tooltip = document.getElementById("myTooltip");
      tooltip.innerHTML = "<b>" + copyText.value + "</b> {%trans 'Copiato nei tuoi appunti.' %}";
      tooltip.style.visibility = 'visible';
    }

    window.onload = function () {
        var input = document.getElementById('id_url');
        input.focus();
        input.select();
    }
</script>
<style>

    #id_captcha {
            padding: 6px;
        }

</style>
{% endblock extra_head %}

{% block page_body %}
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-danger" role="alert">
          {{ message }}
        </div>
        {% endfor %}
    {% endif %}

    {% if urlsh %}
        <div class="jumbotron">
          <h3 class="display-5">
              <input type="text" style="border:none; background: none;" class="w-100"
              value="{{ fqdn }}{{ urlsh.shorten_url }}" id="shortened_url">
          </h3>
          <p class="lead text-secondary">
              {% trans 'Questo è il tuo URL abbreviato.' %}
              {% trans 'Sarà reso disponibile per i prossimi ' %}
                <span style="font-width: 400;">{{ delta_days }}</span>
              {% trans ' giorni a partire da adesso.' %}
          </p>
          <hr class="my-4">

          <p id="myTooltip"></p>
          
          <div>
              <button class="btn btn-primary btn-lg" onclick="copyToClipboard()">
                  {% trans "Copia questo URL nei tuoi appunti" %}
              </button>
          </div>
        </div>
    {% else %}
        <p style="margin-bottom: 3px;">
            {% trans 'Questo servizio consente di conservare per un periodo massimo di ' %}
                {{ delta_days }}
            {% trans 'giorni un url in formato "ristretto".' %}
        </p>
        <p>
            {% trans 'Sarà più facile condividerlo con amici e colleghi.' %}
        </p>
        <form method='POST'>
            {% csrf_token %}
            {{ form.url }}
            <br>
            <img class="captcha_img"
                 src="data:image/png;base64,{{ captcha_img }}" />
            <p class="text-secondary">{% trans "Inserisci il valore rappresentato nella immagine CaPTCHA." %}</p>
            {{ form.captcha }}
            {{ form.captcha_hidden }}
            <button class="btn-primary p-2 ml-2" type='submit'>{% trans 'Crea un URL semplificato' %}</button>
        </form>
    {% endif %}
    
{% endblock page_body %}


